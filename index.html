<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GigarazorLp-Shadow-Black-Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== BODY & BACKGROUND ===== */
body {
  font-family: 'Roboto', sans-serif;
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: linear-gradient(-45deg,#0ff,#f0f,#8e44ad,#16a085);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  color:#fff;
  overflow:hidden;
}
@keyframes gradientBG {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* ===== CONTAINER ===== */
.container {
  width: 550px;
  max-width:95%;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(30px);
  border-radius: 25px;
  box-shadow: 0 0 30px #0ff, 0 0 60px #f0f;
  padding: 30px;
}

/* ===== HEADINGS ===== */
h2 {
  text-align:center;
  margin-bottom:20px;
  color:#0ff;
  font-weight:700;
  text-shadow: 0 0 8px #0ff, 0 0 16px #f0f;
}

/* ===== INPUT & BUTTONS ===== */
input, button { font-family:'Roboto', sans-serif; font-weight:500; }
input {
  width:100%; padding:15px; margin:6px 0; border:none;
  border-radius:14px; background: rgba(255,255,255,0.05); color:white;
  box-shadow: 0 0 6px #0ff inset, 0 0 12px #f0f inset; transition:0.3s;
}
input::placeholder { color: rgba(255,255,255,0.5); font-size:1.1em; }
input:focus { outline:none; box-shadow:0 0 12px #0ff, 0 0 20px #f0f; }

button {
  border-radius:14px; background: linear-gradient(45deg,#9b59b6,#8e44ad);
  color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  box-shadow: 0 0 8px #0ff, 0 0 16px #f0f;
}
button:hover {
  background: linear-gradient(45deg,#8e44ad,#9b59b6);
  box-shadow: 0 0 12px #0ff, 0 0 24px #f0f;
}

/* ===== CHAT AREA ===== */
#chatArea { display:none; flex-direction:column; }
#messages {
  border:1px solid rgba(255,255,255,0.2);
  padding:12px; height:320px; overflow-y:auto;
  border-radius:14px; margin-bottom:12px; background: rgba(0,0,0,0.2);
  display:flex; flex-direction:column; gap:12px; scroll-behavior:smooth;
}

/* ===== MESSAGES ===== */
.message-wrapper { display:flex; align-items:flex-start; gap:6px; }
.message {
  padding:12px 16px; border-radius:20px; max-width:75%;
  word-wrap: break-word; font-size:1.05em; line-height:1.4em;
  transition:0.3s all ease; opacity:0; transform:scale(0.8);
  text-shadow: 0 0 4px #0ff, 0 0 8px #f0f;
}
.message.show { opacity:1; transform:scale(1); animation: flashGlow 0.6s ease; }
@keyframes flashGlow {
  0% { box-shadow: 0 0 0 #0ff; }
  50% { box-shadow: 0 0 20px #0ff,0 0 40px #f0f; }
  100% { box-shadow:0 0 0 #0ff; }
}
.message.own { background: #9b59b6; color:white; box-shadow:0 0 10px #f0f, 0 0 20px #9b59b6;}
.message.other { background: rgba(255,255,255,0.1); color:white; box-shadow:0 0 6px #0ff,0 0 12px #f0f;}

/* ===== FORM ===== */
#form { display: flex; gap: 6px; align-items: center; }
#text { flex:1; border-radius:14px; padding:15px; font-size:1.1em; color:white; background: rgba(0,0,0,0.2); border:none; box-shadow: 0 0 6px #0ff inset, 0 0 12px #f0f inset; transition:0.3s;}
#text::placeholder { color: rgba(255,255,255,0.5); font-size:1.1em; }
#send { padding:15px 24px; font-size:1em; flex-shrink:0; min-width:100px; }

/* ===== SMILIES ===== */
#smilies { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
.smiley {
  cursor:pointer; font-size:1.7em; transition:0.3s;
  text-shadow:0 0 6px #0ff,0 0 12px #f0f;
  display:inline-block;
}
.smiley:hover {
  transform: scale(1.5) rotate(-10deg);
  text-shadow: 0 0 12px #0ff,0 0 24px #f0f;
}
.smiley.flash { animation: flashGlow 0.5s ease; }

/* ===== SPECIAL BUTTONS ===== */
#deleteAllBtn, #refreshBtn, #soundToggleBtn, #logoutBtn {
  padding:12px; font-size:1em; font-weight:bold; margin-bottom:10px;
  border:none; border-radius:14px; cursor:pointer; color:#fff;
  text-shadow: 0 0 6px #0ff,0 0 12px #f0f; transition:0.3s;
}
#deleteAllBtn { background:#e67e22; } #deleteAllBtn:hover { background:#d35400; }
#refreshBtn { background:#16a085; } #refreshBtn:hover { background:#138d75; }
#soundToggleBtn { background:#f39c12; } #soundToggleBtn:hover { background:#d68910; }
#logoutBtn { background:#9b59b6; } #logoutBtn:hover { background:#8e44ad; }

/* ===== SCROLLBAR ===== */
#messages::-webkit-scrollbar { width:10px; }
#messages::-webkit-scrollbar-thumb { background: #0ff; border-radius: 5px; }
#messages::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
</style>
</head>
<body>
<div class="container">
  <div id="authArea">
    <h2>Live Chat Login</h2>
    <input type="text" id="nickname" placeholder="Chatname"/>
    <input type="email" id="email" placeholder="Email"/>
    <input type="password" id="password" placeholder="Passwort"/>
    <button id="loginBtn">Anmelden</button>
    <button id="registerBtn">Registrieren</button>
    <p><a id="resetPassword">Passwort vergessen?</a></p>
    <div id="status"></div>
  </div>

  <div id="chatArea">
    <h2>Willkommen, <span id="userName"></span>!</h2>
    <button id="refreshBtn">Chat aktualisieren</button>
    <button id="deleteAllBtn">Alle Chatnachrichten lÃ¶schen</button>
    <button id="soundToggleBtn">Sound: AN</button>
    <div id="messages"></div>

    <div id="smilies">
      <span class="smiley">ğŸ˜€</span><span class="smiley">ğŸ˜</span><span class="smiley">ğŸ˜‚</span><span class="smiley">ğŸ¤£</span>
      <span class="smiley">ğŸ˜</span><span class="smiley">ğŸ˜˜</span><span class="smiley">ğŸ˜œ</span><span class="smiley">ğŸ˜</span>
      <span class="smiley">ğŸ¥³</span><span class="smiley">ğŸ¥°</span><span class="smiley">ğŸ˜­</span><span class="smiley">ğŸ˜¡</span>
      <span class="smiley">ğŸ¤”</span><span class="smiley">ğŸ™„</span><span class="smiley">ğŸ˜</span><span class="smiley">ğŸ¤©</span>
      <span class="smiley">ğŸ¶</span><span class="smiley">ğŸ±</span><span class="smiley">ğŸ¦„</span><span class="smiley">ğŸ¸</span>
      <span class="smiley">ğŸ•</span><span class="smiley">ğŸ”</span><span class="smiley">ğŸŸ</span><span class="smiley">ğŸŒ­</span>
      <span class="smiley">ğŸ‰</span><span class="smiley">ğŸ’</span><span class="smiley">âš¡</span><span class="smiley">ğŸŒˆ</span>
    </div>

    <div id="form">
      <input id="text" placeholder="Nachricht eingeben..."/>
      <button id="send">Senden</button>
    </div>
    <button id="logoutBtn">Abmelden</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
import { getDatabase, ref, push, onChildAdded, remove, set, get } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";

// ===== FIREBASE =====
const firebaseConfig = {
  apiKey: "AIzaSyAjj7CGTPWgXYIaCZpLT6O46SOAQ_ptZ7g",
  authDomain: "live-chat-test-a67b8.firebaseapp.com",
  databaseURL: "https://live-chat-test-a67b8-default-rtdb.firebaseio.com",
  projectId: "live-chat-test-a67b8",
  storageBucket: "live-chat-test-a67b8.firebasestorage.app",
  messagingSenderId: "244677510641",
  appId: "1:244677510641:web:b397529ae31887f9dbb050"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const messagesRef = ref(db,'messages');

// ===== DOM ELEMENTE =====
const authArea = document.getElementById('authArea');
const chatArea = document.getElementById('chatArea');
const nicknameInput = document.getElementById('nickname');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const resetLink = document.getElementById('resetPassword');
const status = document.getElementById('status');
const messagesDiv = document.getElementById('messages');
const textInput = document.getElementById('text');
const sendBtn = document.getElementById('send');
const logoutBtn = document.getElementById('logoutBtn');
const userNameSpan = document.getElementById('userName');
const smiliesDiv = document.getElementById('smilies');
const deleteAllBtn = document.getElementById('deleteAllBtn');
const refreshBtn = document.getElementById('refreshBtn');
const soundToggleBtn = document.getElementById('soundToggleBtn');

// ===== SOUND =====
const sendSound = new Audio('send.mp3');
const receiveSound = new Audio('receive.mp3');
let soundOn = true;
soundToggleBtn.onclick = ()=>{ soundOn = !soundOn; soundToggleBtn.innerText = `Sound: ${soundOn ? "AN":"AUS"}`; }

// ===== HELPER: Klartext-Fehler =====
function firebaseErrorMessage(code){
  switch(code){
    case 'auth/invalid-email': return 'UngÃ¼ltige Email-Adresse.';
    case 'auth/user-disabled': return 'Dieser Benutzer wurde deaktiviert.';
    case 'auth/user-not-found': return 'Kein Benutzer mit dieser Email gefunden.';
    case 'auth/wrong-password': return 'Falsches Passwort.';
    case 'auth/email-already-in-use': return 'Diese Email ist bereits registriert.';
    case 'auth/weak-password': return 'Das Passwort ist zu schwach (mind. 6 Zeichen).';
    case 'auth/invalid-login-credentials': return 'Falsche Login-Daten.';
    case 'auth/missing-email': return 'Bitte Email eingeben.';
    default: return 'Unbekannter Fehler: '+code;
  }
}

// ===== REGISTER =====
registerBtn.onclick = () => {
  const email = emailInput.value.trim();
  const pass = passwordInput.value;
  const nickname = nicknameInput.value.trim();
  if(!nickname){ status.innerText="Bitte Nickname eingeben"; return; }
  if(!email||!pass){ status.innerText="Email und Passwort eingeben"; return; }

  createUserWithEmailAndPassword(auth,email,pass)
    .then(()=>{ localStorage.setItem('nickname',nickname); status.innerText='Registrierung erfolgreich!'; })
    .catch(err=>status.innerText=firebaseErrorMessage(err.code));
}

// ===== LOGIN =====
loginBtn.onclick = () => {
  const email = emailInput.value.trim();
  const pass = passwordInput.value;
  const nickname = nicknameInput.value.trim();
  if(!nickname){ status.innerText="Bitte Nickname eingeben"; return; }
  if(!email||!pass){ status.innerText="Email und Passwort eingeben"; return; }

  signInWithEmailAndPassword(auth,email,pass)
    .then(()=>{ localStorage.setItem('nickname',nickname); status.innerText='Login erfolgreich!'; })
    .catch(err=>status.innerText=firebaseErrorMessage(err.code));
}

// ===== PASSWORD RESET =====
resetLink.onclick = () => {
  const email = emailInput.value.trim();
  if(!email){ status.innerText="Bitte Email eingeben"; return; }

  sendPasswordResetEmail(auth,email)
    .then(()=>status.innerText="Passwort-ZurÃ¼cksetzungsmail gesendet.")
    .catch(err=>status.innerText=firebaseErrorMessage(err.code));
}

// ===== LOGOUT =====
logoutBtn.onclick = ()=>signOut(auth);

// ===== AUTH STATE =====
onAuthStateChanged(auth,user=>{
  if(user){
    authArea.style.display='none';
    chatArea.style.display='flex';
    userNameSpan.innerText = localStorage.getItem('nickname') || "Unbekannt";
    loadMessages();
  } else {
    authArea.style.display='block';
    chatArea.style.display='none';
    messagesDiv.innerHTML='';
  }
});

// ===== SEND MESSAGE =====
sendBtn.onclick = sendMessage;
textInput.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMessage(); });

function sendMessage(){
  const text = textInput.value.trim();
  if(!text) return;
  const nickname = localStorage.getItem('nickname') || "Unbekannt";

  if(soundOn){ sendSound.currentTime=0; sendSound.play(); }
  push(messagesRef,{name:nickname,text,ts:Date.now()});
  textInput.value='';
}

// ===== LOAD MESSAGES =====
function loadMessages(){
  messagesDiv.innerHTML='';
  get(messagesRef).then(snapshot=>{
    if(snapshot.exists()){
      const data = snapshot.val();
      Object.entries(data).sort((a,b)=>a[1].ts-b[1].ts).forEach(([key,msg])=>{
        const nickname = localStorage.getItem('nickname') || "Unbekannt";
        const wrapper = document.createElement('div');
        wrapper.className="message-wrapper";

        const div = document.createElement('div');
        div.classList.add('message', nickname===msg.name?'own':'other');
        div.innerHTML = `<strong>${msg.name}</strong>: ${msg.text}`;
        wrapper.appendChild(div);

        if(nickname===msg.name){
          const delBtn = document.createElement('button');
          delBtn.className="delBtn";
          delBtn.innerText="LÃ¶schen";
          delBtn.onclick = ()=>remove(ref(db,'messages/'+key)).then(()=>wrapper.remove());
          wrapper.appendChild(delBtn);
        } else if(soundOn){
          receiveSound.currentTime=0; receiveSound.play();
        }

        messagesDiv.appendChild(wrapper);
        setTimeout(()=>div.classList.add('show'),50);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
}
onChildAdded(messagesRef,loadMessages);
refreshBtn.onclick=loadMessages;
deleteAllBtn.onclick=()=>{ if(confirm("Alle Nachrichten wirklich lÃ¶schen?")) set(messagesRef,null); }

// ===== SMILIES CLICK =====
smiliesDiv.querySelectorAll('.smiley').forEach(s=>{
  s.onclick=()=>{
    textInput.value += s.innerText;
    s.classList.add('flash');
    setTimeout(()=>s.classList.remove('flash'),500);
    textInput.focus();
  }
});
</script>
</body>
</html>
